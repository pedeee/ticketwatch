name: 🎟️ Ticketwatch Hourly Monitor

on:
  schedule:
    # Run every 6 hours at minute 0
    - cron: '0 */6 * * *'
  workflow_dispatch:
    # Allow manual trigger
    inputs:
      debug:
        description: 'Enable debug mode'
        required: false
        default: 'false'

jobs:
  batch1:
    runs-on: ubuntu-latest
    timeout-minutes: 60
    
    env:
      TG_TOKEN: ${{ secrets.TG_TOKEN }}
      TG_CHAT: ${{ secrets.TG_CHAT }}
      GITHUB_ACTIONS: "true"
      
    steps:
    - name: 🚀 Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}

    - name: 🐍 Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.12'

    - name: 📦 Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        playwright install chromium

    - name: 🎟️ Run Batch 1
      run: |
        echo "🔄 Processing batch1.txt..."
        python ticketwatch_v2.py url_batches/batch1.txt

  batch2:
    runs-on: ubuntu-latest
    timeout-minutes: 60
    
    env:
      TG_TOKEN: ${{ secrets.TG_TOKEN }}
      TG_CHAT: ${{ secrets.TG_CHAT }}
      GITHUB_ACTIONS: "true"
      
    steps:
    - name: 🚀 Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}

    - name: 🐍 Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.12'

    - name: 📦 Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        playwright install chromium

    - name: 🎟️ Run Batch 2
      run: |
        echo "🔄 Processing batch2.txt..."
        python ticketwatch_v2.py url_batches/batch2.txt

  batch3:
    runs-on: ubuntu-latest
    timeout-minutes: 60
    
    env:
      TG_TOKEN: ${{ secrets.TG_TOKEN }}
      TG_CHAT: ${{ secrets.TG_CHAT }}
      GITHUB_ACTIONS: "true"
      
    steps:
    - name: 🚀 Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}

    - name: 🐍 Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.12'

    - name: 📦 Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        playwright install chromium

    - name: 🎟️ Run Batch 3
      run: |
        echo "🔄 Processing batch3.txt..."
        python ticketwatch_v2.py url_batches/batch3.txt

  batch4:
    runs-on: ubuntu-latest
    timeout-minutes: 60
    
    env:
      TG_TOKEN: ${{ secrets.TG_TOKEN }}
      TG_CHAT: ${{ secrets.TG_CHAT }}
      GITHUB_ACTIONS: "true"
      
    steps:
    - name: 🚀 Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}

    - name: 🐍 Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.12'

    - name: 📦 Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        playwright install chromium

    - name: 🎟️ Run Batch 4
      run: |
        echo "🔄 Processing batch4.txt..."
        python ticketwatch_v2.py url_batches/batch4.txt

  batch5:
    runs-on: ubuntu-latest
    timeout-minutes: 60
    
    env:
      TG_TOKEN: ${{ secrets.TG_TOKEN }}
      TG_CHAT: ${{ secrets.TG_CHAT }}
      GITHUB_ACTIONS: "true"
      
    steps:
    - name: 🚀 Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}

    - name: 🐍 Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.12'

    - name: 📦 Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        playwright install chromium

    - name: 🎟️ Run Batch 5
      run: |
        echo "🔄 Processing batch5.txt..."
        python ticketwatch_v2.py url_batches/batch5.txt